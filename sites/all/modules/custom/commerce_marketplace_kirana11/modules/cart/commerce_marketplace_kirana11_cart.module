<?php
/**
 * Implements hook_init().
 */
function commerce_marketplace_kirana11_cart_init() {
  drupal_add_js(drupal_get_path('module', 'commerce_marketplace_kirana11_cart') . '/js/script.js');
}

/**
 * Implements hook_block_info().
 */
function commerce_marketplace_kirana11_cart_block_info() {
  $blocks = [];

  $blocks['check_location_change'] = array(
    'info' => t('Check location change with non-empty cart'),
    'cache' => DRUPAL_NO_CACHE,
  );

  return $blocks;
}

/**
 * Implements hook_block_view().
 */
function commerce_marketplace_kirana11_cart_block_view($delta = '') {
  $block = [];

  switch ($delta) {
    case 'check_location_change':
        $block['content'] = commerce_marketplace_kirana11_cart_block_content();
    break;
  }

  return $block;
}

function commerce_marketplace_kirana11_cart_block_content() {
  global $user;
  $html_location_change = 'EMPTY_CART';

  $user_order_in_cart = commerce_cart_order_load($user->uid);

  if ($user_order_in_cart) {
    $html_location_change = '<div class="not-empty-location">';
    $html_location_change .= 'You have cart item(s). Change location will empty the current cart. Do you want to continue?';
    $html_location_change .= '<br/><input type="button" id="click-no" class="click-no" value="No" /> <input type="button" id="click-yes" class="click-yes" value="Yes" />';
    $html_location_change .= '</div>';
  }

  return $html_location_change;
}

/**
 * Implements hook_menu().
 */
function commerce_marketplace_kirana11_cart_menu() {
  $items = array();

  $items['empty_cart_orders'] = array(
    'title' => t('Empty the cart orders'),
    'page callback' => 'commerce_marketplace_kirana11_cart_empty_cart_order',
    'access arguments' => array('access content'),
    'type' => MENU_NORMAL_ITEM,
  );

  return $items;
}

/**
 * Remove all the orders (from each store) in the cart for the current logged in user.
 */
function commerce_marketplace_kirana11_cart_empty_cart_order() {
  global $user;

  if ($orders = commerce_marketplace_cart_order_load_multiple($user->uid)) {
    foreach ($orders as $order) {
      commerce_cart_order_empty($order);
    }
  }

  return drupal_json_output('CART_EMPTY');
}
